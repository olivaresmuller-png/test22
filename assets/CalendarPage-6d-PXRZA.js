import{c as cs,t as ds,a as Os,b as _e,s as _s,r as o,u as Zs,j as e,D as Me,d as ke,B as w,e as De,f as Te,g as Oe,h as mt,U as ht,T as Es,i as ut,k as p,S as is,l as v,C as Js,G as As,P as ft,m as Xs,n as Qs,o as et,p as Ns,q as G,v as Us,w as pt,x as gt,y as vs,z as K,A as Re,I as Cs,E as Fe,F as jt,H as yt,J as Ss,K as ws,L as bt,M as Nt}from"./index-CI72K9i1.js";import{F as Hs,r as vt,u as Ct,l as St,S as wt,U as zs}from"./xlsx-DQPdkPbZ.js";import{S as Ue}from"./scroll-area-CMybtgpe.js";import{B as A,L as Se}from"./label-z0vxqCoA.js";import{C as Ks,a as Xe,s as Mt}from"./setWeek-CC9fEd-6.js";import{S as he,a as ue,b as fe,c as $e,d as Ve,e as D,f as ge}from"./select-DhOR1Qsq.js";import{T as kt,a as Dt,b as Ms}from"./tabs-Cj8txYyn.js";import{P as Tt,C as Ot,T as ks,a as Ds,b as We,c as q,d as Ts,e as Z}from"./table-CmNjyXus.js";import{P as Et}from"./pen-Dp87l7uz.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]],It=cs("coffee",At);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],Pt=cs("heart",Bt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Ys=cs("loader-circle",Lt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Ft=cs("shield",Rt);function st(a,r){const c=ds(a);if(isNaN(r))return Os(a,NaN);if(!r)return c;const f=c.getDate(),C=Os(a,c.getTime());C.setMonth(c.getMonth()+r+1,0);const I=C.getDate();return f>=I?C:(c.setFullYear(C.getFullYear(),C.getMonth(),f),c)}function tt(a,r){const c=r*7;return _e(a,c)}function $t(a){return Os(a,Date.now())}function Vt(a,r){const c=_s(a),f=_s(r);return+c==+f}function Wt(a){const r=ds(a),c=r.getMonth();return r.setFullYear(r.getFullYear(),c+1,0),r.setHours(23,59,59,999),r}function Gt(a){const r=ds(a);return r.setDate(1),r.setHours(0,0,0,0),r}function Is(a){return ds(a).getDay()}function He(a){return Vt(a,$t(a))}function _t(a,r){return st(a,-1)}function Ut(a,r){return tt(a,-1)}const qs={jan:0,feb:1,mar:2,mär:2,apr:3,may:4,mai:4,jun:5,jul:6,aug:7,sep:8,oct:9,okt:9,nov:10,dec:11,dez:11};function Ht(){const[a,r]=o.useState(!1),[c,f]=o.useState(!1),[C,I]=o.useState(!1),[i,t]=o.useState(null),[T,B]=o.useState(null),_=o.useRef(null),{employees:Ee,updateAssignment:ae}=Zs(),ye=j=>{const P=j.join(" ").toLowerCase();for(const[be,ss]of Object.entries(qs))if(P.includes(be))return ss;return new Date().getMonth()},os=async j=>{f(!0),B(null),t(null);try{const P=await j.arrayBuffer(),be=vt(P,{type:"array"}),ss=be.SheetNames[0],ts=be.Sheets[ss],Q=Ct.sheet_to_json(ts,{header:1,defval:""});if(Q.length<8)throw new Error("Excel file does not have enough rows. Expected at least 8 rows.");const Ae=Q[4]||[],te=Q[5]||[],ms=Q[6]||[],F=ye(Ae);let Ie=new Date().getFullYear();for(let O=0;O<Math.min(5,Q.length);O++){const ie=Q[O].join(" ").match(/20\d{2}/);if(ie){Ie=parseInt(ie[0]);break}}const ne=[];for(let O=3;O<te.length;O++){const ee=te[O];if(!ee)continue;const ie=String(ee).trim(),y=parseInt(ie,10);if(isNaN(y)||y<1||y>31)continue;let Ne=F;const pe=String(Ae[O]||"").toLowerCase();for(const[Ke,fs]of Object.entries(qs))if(pe.includes(Ke)){Ne=fs;break}let ve=Ie;Ne<F&&F>=10&&Ne<=2&&(ve=Ie+1);const ce=new Date(ve,Ne,y);isNaN(ce.getTime())||ne.push({col:O,dateStr:p(ce,"yyyy-MM-dd")})}if(ne.length===0)throw new Error("Could not find valid dates in row 6. Make sure day numbers (1-31) are in row 6 starting from column D.");const Be=[],re=new Set,hs=7;for(let O=hs;O<Q.length;O++){const ee=Q[O];if(!ee||ee.length<4)continue;const ie=ee[2];if(!ie)continue;const y=String(ie).trim().toUpperCase();if(y.length<2||y.length>6||/\d/.test(y)||y.includes("(")||y.includes("ENGINEER")||y.includes("MANAGER")||y.includes("SUPERVISOR")||y.includes("PRODUCTION")||y.includes("HEAD")||y.includes("TMB")||y.includes("EMPLOYEE")||y.includes("SENIOR")||y.includes("EXTERNAL")||y.includes("CODE")||y.includes("3/4"))continue;if(!Ee.find(pe=>pe.initials.toUpperCase()===y)){y.match(/^[A-Z]{3,5}$/)&&re.add(y);continue}for(const pe of ne){const ve=ee[pe.col];if(!ve)continue;const ce=String(ve).trim();!ce||ce==="-"||ce===""||Be.push({employeeInitials:y,date:pe.dateStr,shiftCode:ce})}}const le=ne.map(O=>O.dateStr).sort(),us=le.length>0?{start:le[0],end:le[le.length-1]}:null;t({total:Be.length,matched:new Set(Be.map(O=>O.employeeInitials)).size,unmatched:Array.from(re),shifts:Be,dateRange:us})}catch(P){B(P instanceof Error?P.message:"Failed to parse Excel file")}finally{f(!1)}},ze=async()=>{if(i){I(!0);try{for(const j of i.shifts){const P=Ee.find(be=>be.initials.toUpperCase()===j.employeeInitials);P&&ae(j.date,P.id,j.shiftCode)}r(!1),t(null)}finally{I(!1)}}},xs=j=>{const P=j.target.files?.[0];P&&os(P),_.current&&(_.current.value="")},es=()=>{r(!1),t(null),B(null)};return e.jsxs(Me,{open:a,onOpenChange:j=>j?r(!0):es(),children:[e.jsx(ke,{asChild:!0,children:e.jsxs(w,{variant:"outline",className:"gap-2","data-testid":"button-import-excel",children:[e.jsx(Hs,{className:"w-4 h-4"}),"Import Excel"]})}),e.jsxs(De,{className:"max-w-lg",children:[e.jsxs(Te,{children:[e.jsxs(Oe,{className:"flex items-center gap-2",children:[e.jsx(Hs,{className:"w-5 h-5"}),"Import Shift Schedule from Excel"]}),e.jsx(mt,{children:"Upload Excel file with shifts. Format: Row 5 = Month, Row 6 = Day, Row 7 = Weekday, Column C = Employee code, Column D+ = Shifts"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{ref:_,type:"file",accept:".xlsx,.xls",onChange:xs,className:"hidden"}),e.jsx(w,{onClick:()=>_.current?.click(),disabled:c,className:"w-full gap-2",variant:"outline",children:c?e.jsxs(e.Fragment,{children:[e.jsx(Ys,{className:"w-4 h-4 animate-spin"}),"Parsing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ht,{className:"w-4 h-4"}),"Select Excel File"]})}),T&&e.jsxs("div",{className:"p-3 bg-destructive/10 text-destructive rounded-lg flex items-start gap-2",children:[e.jsx(Es,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:T})]}),i&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-4 bg-muted/50 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(Ks,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"File parsed successfully"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Shifts found:"}),e.jsx("span",{className:"ml-2 font-medium",children:i.total})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Employees matched:"}),e.jsx("span",{className:"ml-2 font-medium",children:i.matched})]})]}),i.dateRange&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Date range:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[i.dateRange.start," to ",i.dateRange.end]})]})]}),i.unmatched.length>0&&e.jsxs("div",{className:"p-3 bg-yellow-500/10 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-yellow-600 mb-2",children:[e.jsx(Es,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm font-medium",children:["Unmatched employees (",i.unmatched.length,")"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[i.unmatched.slice(0,10).map(j=>e.jsx(A,{variant:"outline",className:"text-xs",children:j},j)),i.unmatched.length>10&&e.jsxs(A,{variant:"outline",className:"text-xs",children:["+",i.unmatched.length-10," more"]})]})]}),i.shifts.length>0&&e.jsx(Ue,{className:"h-[150px] border rounded-lg",children:e.jsxs("div",{className:"p-2 space-y-1",children:[i.shifts.slice(0,50).map((j,P)=>e.jsxs("div",{className:"flex justify-between text-xs px-2 py-1 hover:bg-muted/50 rounded",children:[e.jsx("span",{className:"font-mono",children:j.employeeInitials}),e.jsx("span",{className:"text-muted-foreground",children:j.date}),e.jsx(A,{variant:"secondary",className:"text-xs",children:j.shiftCode})]},P)),i.shifts.length>50&&e.jsxs("div",{className:"text-center text-xs text-muted-foreground py-2",children:["... and ",i.shifts.length-50," more shifts"]})]})})]})]}),e.jsxs(ut,{children:[e.jsx(w,{variant:"outline",onClick:es,children:"Cancel"}),e.jsx(w,{onClick:ze,disabled:!i||i.total===0||C,className:"gap-2",children:C?e.jsxs(e.Fragment,{children:[e.jsx(Ys,{className:"w-4 h-4 animate-spin"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ks,{className:"w-4 h-4"}),"Import ",i?.total||0," Shifts"]})})]})]})]})}const je=o.memo(function({code:r,size:c="md",showLabel:f=!1}){const C=is.find(t=>t.code===r),I=()=>r==="Ea"||r==="e"?"shift-early":r==="La"||r==="AL"?"shift-late":r==="Ae"||r==="eA"?"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400":r==="V"?"shift-vacation":r==="T"||r==="TD"?"shift-training":r==="S"?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400":"shift-off",i={xs:"text-[8px] px-1 py-0 min-w-[20px]",sm:"text-[10px] px-1.5 py-0.5 min-w-[28px]",md:"text-xs px-2 py-1 min-w-[36px]",lg:"text-sm px-3 py-1.5 min-w-[48px]"};return e.jsxs("span",{"data-testid":`badge-shift-${r}`,className:v("inline-flex items-center justify-center font-mono font-semibold rounded-md transition-colors",I(),i[c]),children:[r,f&&C&&e.jsx("span",{className:"ml-1.5 font-sans font-normal opacity-75",children:C.label})]})}),zt=["Ea","La","M","Ae","AL","e","eA","l","LA","TD","HO","t4"],Kt=["FT","BT","ET","FD","SI","SE","Sn","TR"],Yt=["V","PW","PC","PB","PD","PG","PI","PH","PM","PL","UL","KO","KB","FL"],qt=["S","IC","IW","AC","AW"],Zt=["MC","MW"],Jt=["-","OFF","T","?"],Ge={Ea:"06:15–15:09 • TMB Earlyshift",La:"14:00–22:54 • TMB Lateshift",M:"08:00–17:20 • TMB Mid-shift",Ae:"05:45–14:39 • TMB PL STV Early",AL:"13:30–22:24 • TMB PL STV Late",e:"TMB Earlyshift PM",eA:"05:45–14:39 • TMB PL Early",l:"TMB Lateshift PM",LA:"13:30–22:24 • TMB PL Late",TD:"Part Time Day shift",t4:"Classroom Training 4H",FT:"Feiertag / Public CH",BT:"Business Trip",SI:"School internal",SE:"School external",Sn:"School night",V:"Vacation",PW:"Wedding (own) - 3 Days",PB:"Birth - 2 Days",PD:"Death (Spouse/Child/Parents) - 3 Days",UL:"Unpaid Leave",KO:"Kompensation ex Overtime",KB:"Kompensation ex Timebonus",S:"Sick with Certificate",IC:"Sick with Certificate",IW:"Sick without Certificate",IB:"Baby Leave with Certificate",IM:"Baby Leave",IN:"Nurse of close relatives",AC:"Accident with Certificate",AW:"Accident without Certificate",MC:"Military with EO",MW:"Military without EO",FL:"Kompensation ex Flextime",HO:"Home Office",ET:"Educational Trip",FD:"Flight Duty",OF:"Office Duty",PR:"Projects",PC:"Wedding (Child) - 1 Day",PG:"Death (In-Law/Grandp.) - 2 Days",PI:"Death (In-Law/Sibling) - 1 Day",PH:"Moving HB >100km - 2 Days",PM:"Moving - 1 Day",PL:"Paid Leave",PK:"Baby Leave (Mutterschaftsurl)",ST:"Study Time",TO:"Time out",TR:"08:00–17:00 • Training","-":"Off day",OFF:"Scheduled off duty",T:"Training day","?":"Unassigned / TBD"},Bs=o.memo(function({value:r,onValueChange:c,compact:f,"data-testid":C}){const I=is.find(t=>t.code===r),i=t=>is.filter(T=>t.includes(T.code));return e.jsxs(he,{value:r,onValueChange:t=>c(t),children:[e.jsxs(ue,{className:v("gap-2 border-2 hover:border-primary/50 transition-colors",f?"w-auto h-8 px-2":"w-auto"),"data-testid":C,children:[e.jsx(je,{code:r,size:"sm"}),!f&&I&&I.hours>0&&e.jsxs("span",{className:"text-xs text-muted-foreground font-medium",children:[I.hours,"h"]})]}),e.jsxs(fe,{className:"w-[340px] max-h-[450px]",children:[e.jsxs($e,{children:[e.jsxs(Ve,{className:"flex items-center gap-2 text-primary font-semibold py-2",children:[e.jsx(Js,{className:"w-4 h-4"}),"Work Shifts"]}),i(zt).map(t=>e.jsx(D,{value:t.code,className:"py-2.5 cursor-pointer hover:bg-primary/5",children:e.jsxs("div",{className:"flex items-start gap-3 w-full",children:[e.jsx(je,{code:t.code,size:"sm"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-semibold",children:t.label}),e.jsxs("span",{className:"text-xs text-emerald-600 font-bold bg-emerald-50 px-1.5 py-0.5 rounded ml-2",children:[t.hours,"h"]})]}),e.jsx("p",{className:"text-[11px] text-muted-foreground mt-0.5 leading-tight",children:Ge[t.code]})]})]})},t.code))]}),e.jsx("div",{className:"h-px bg-border my-2"}),e.jsxs($e,{children:[e.jsxs(Ve,{className:"flex items-center gap-2 text-blue-600 font-semibold py-2",children:[e.jsx(As,{className:"w-4 h-4"}),"Training & Business"]}),i(Kt).map(t=>e.jsx(D,{value:t.code,className:"py-2.5 cursor-pointer hover:bg-blue-50",children:e.jsxs("div",{className:"flex items-start gap-3 w-full",children:[e.jsx(je,{code:t.code,size:"sm"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-semibold",children:t.label}),t.hours>0&&e.jsxs("span",{className:"text-xs text-blue-600 font-bold bg-blue-50 px-1.5 py-0.5 rounded ml-2",children:[t.hours,"h"]})]}),e.jsx("p",{className:"text-[11px] text-muted-foreground mt-0.5 leading-tight",children:Ge[t.code]})]})]})},t.code))]}),e.jsx("div",{className:"h-px bg-border my-2"}),e.jsxs($e,{children:[e.jsxs(Ve,{className:"flex items-center gap-2 text-amber-600 font-semibold py-2",children:[e.jsx(ft,{className:"w-4 h-4"}),"Leave & Time Off"]}),i(Yt).map(t=>e.jsx(D,{value:t.code,className:"py-2.5 cursor-pointer hover:bg-amber-50",children:e.jsxs("div",{className:"flex items-start gap-3 w-full",children:[e.jsx(je,{code:t.code,size:"sm"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-sm font-semibold",children:t.label}),e.jsx("p",{className:"text-[11px] text-muted-foreground mt-0.5 leading-tight",children:Ge[t.code]})]})]})},t.code))]}),e.jsx("div",{className:"h-px bg-border my-2"}),e.jsxs($e,{children:[e.jsxs(Ve,{className:"flex items-center gap-2 text-rose-600 font-semibold py-2",children:[e.jsx(Pt,{className:"w-4 h-4"}),"Sick Leave"]}),i(qt).map(t=>e.jsx(D,{value:t.code,className:"py-2.5 cursor-pointer hover:bg-rose-50",children:e.jsxs("div",{className:"flex items-start gap-3 w-full",children:[e.jsx(je,{code:t.code,size:"sm"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-sm font-semibold",children:t.label}),e.jsx("p",{className:"text-[11px] text-muted-foreground mt-0.5 leading-tight",children:Ge[t.code]})]})]})},t.code))]}),e.jsx("div",{className:"h-px bg-border my-2"}),e.jsxs($e,{children:[e.jsxs(Ve,{className:"flex items-center gap-2 text-indigo-600 font-semibold py-2",children:[e.jsx(Ft,{className:"w-4 h-4"}),"Military Service"]}),i(Zt).map(t=>e.jsx(D,{value:t.code,className:"py-2.5 cursor-pointer hover:bg-indigo-50",children:e.jsxs("div",{className:"flex items-start gap-3 w-full",children:[e.jsx(je,{code:t.code,size:"sm"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-sm font-semibold",children:t.label}),e.jsx("p",{className:"text-[11px] text-muted-foreground mt-0.5 leading-tight",children:Ge[t.code]})]})]})},t.code))]}),e.jsx("div",{className:"h-px bg-border my-2"}),e.jsxs($e,{children:[e.jsxs(Ve,{className:"flex items-center gap-2 text-slate-500 font-semibold py-2",children:[e.jsx(It,{className:"w-4 h-4"}),"Off Duty"]}),i(Jt).map(t=>e.jsx(D,{value:t.code,className:"py-2.5 cursor-pointer hover:bg-slate-50",children:e.jsxs("div",{className:"flex items-start gap-3 w-full",children:[e.jsx(je,{code:t.code,size:"sm"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-sm font-semibold",children:t.label}),e.jsx("p",{className:"text-[11px] text-muted-foreground mt-0.5 leading-tight",children:Ge[t.code]})]})]})},t.code))]})]})]})}),Xt=o.memo(function({employees:r,weekDates:c,getAssignment:f,onShiftChange:C,onDayClick:I}){return e.jsxs("div",{className:"min-w-[800px]",children:[e.jsxs("div",{className:"flex border-b border-border bg-muted/20 sticky top-0 z-20",children:[e.jsx("div",{className:"text-left p-3 font-medium text-muted-foreground sticky left-0 bg-card z-10 min-w-[200px] w-[200px] flex-shrink-0",children:"Employee"}),c.map(i=>e.jsxs("div",{onClick:()=>I?.(i),className:v("p-3 text-center min-w-[80px] flex-1 cursor-pointer hover:bg-muted/50 transition-colors",He(new Date(i))&&"bg-primary/5"),children:[e.jsx("div",{className:"font-medium",children:p(new Date(i),"EEE")}),e.jsx("div",{className:v("text-sm",He(new Date(i))?"text-primary font-semibold":"text-muted-foreground"),children:p(new Date(i),"d")})]},i))]}),e.jsx("div",{className:"max-h-[calc(100vh-280px)] overflow-y-auto",children:r.map(i=>e.jsxs("div",{className:v("flex border-b border-border/50",i.role==="PM"&&"bg-amber-50 dark:bg-amber-950/30",i.role==="PS"&&"bg-emerald-50 dark:bg-emerald-950/30",i.role==="SrEng"&&"bg-lime-50 dark:bg-lime-950/20"),children:[e.jsx("div",{className:v("p-3 sticky left-0 z-10 border-r border-border/50 min-w-[200px] w-[200px] flex-shrink-0 flex items-center",i.role==="PM"?"bg-amber-50 dark:bg-amber-950/30":i.role==="PS"?"bg-emerald-50 dark:bg-emerald-950/30":i.role==="SrEng"?"bg-lime-50 dark:bg-lime-950/20":"bg-card"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center text-xs font-mono font-bold text-primary",children:i.initials}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:i.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:i.department.replace("S/","")})]})]})}),c.map(t=>{const T=f(t,i.id)||"-";return e.jsxs("div",{className:v("p-2 flex-1 flex items-center justify-center min-w-[80px]",He(new Date(t))&&"bg-primary/5"),children:[e.jsx("span",{className:"print-only font-mono text-xs font-medium",children:T}),e.jsx("span",{className:"screen-only",children:e.jsx(Bs,{value:T,onValueChange:B=>C(t,i.id,B),compact:!0,"data-testid":`select-shift-${i.id}-${t}`})})]},t)})]},i.id))})]})}),Qt=o.memo(function({employees:r,monthDays:c,getAssignment:f,onShiftChange:C}){const[I,i]=o.useState(null);return e.jsxs("div",{className:"min-w-[1200px]",children:[e.jsxs("div",{className:"flex border-b border-border bg-muted/20 sticky top-0 z-20",children:[e.jsx("div",{className:"text-left p-2 font-medium text-muted-foreground sticky left-0 bg-card z-10 min-w-[180px] w-[180px] flex-shrink-0 text-xs",children:"Employee"}),c.map(t=>{const T=p(t,"yyyy-MM-dd"),B=[0,6].includes(Is(t));return e.jsxs("div",{className:v("p-1 text-center min-w-[32px] flex-1 text-xs",B&&"bg-muted/50",He(t)&&"bg-primary/10"),children:[e.jsx("div",{className:"font-medium",children:p(t,"EEE")[0]}),e.jsx("div",{className:v("text-[10px]",He(t)?"text-primary font-bold":"text-muted-foreground"),children:p(t,"d")})]},T)})]}),e.jsx("div",{className:"max-h-[calc(100vh-280px)] overflow-y-auto",children:r.map(t=>e.jsxs("div",{className:v("flex border-b border-border/50",t.role==="PM"&&"bg-amber-50/50",t.role==="PS"&&"bg-emerald-50/50",t.role==="SrEng"&&"bg-lime-50/50"),children:[e.jsx("div",{className:v("p-2 sticky left-0 z-10 border-r border-border/50 text-xs min-w-[180px] w-[180px] flex-shrink-0 flex items-center",t.role==="PM"?"bg-amber-50":t.role==="PS"?"bg-emerald-50":t.role==="SrEng"?"bg-lime-50":"bg-card"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono font-bold text-primary text-[10px]",children:t.initials}),e.jsx("span",{className:"font-medium truncate max-w-[120px]",children:t.name.split(",")[0]})]})}),c.map(T=>{const B=p(T,"yyyy-MM-dd"),_=f(B,t.id)||"-",Ee=[0,6].includes(Is(T)),ae=`${t.id}-${B}`;return e.jsxs("div",{className:v("p-0.5 flex-1 flex items-center justify-center min-w-[32px]",Ee&&"bg-muted/30",He(T)&&"bg-primary/5"),children:[e.jsx("span",{className:"print-only font-mono text-[9px] font-medium",children:_}),e.jsx("span",{className:"screen-only",children:e.jsxs(Xs,{open:I===ae,onOpenChange:ye=>i(ye?ae:null),children:[e.jsx(Qs,{asChild:!0,children:e.jsx("button",{className:"cursor-pointer hover:scale-110 transition-transform",children:e.jsx(je,{code:_,size:"xs"})})}),e.jsx(et,{className:"w-48 p-2",align:"center",children:e.jsx(Bs,{value:_,onValueChange:ye=>{C(B,t.id,ye),i(null)},"data-testid":`select-shift-month-${t.id}-${B}`})})]})})]},B)})]},t.id))})]})}),ls=216,me=216,J=6,X=2,Qe=30,we=35;function xn(){const{employees:a,assignments:r,selectedDate:c,setSelectedDate:f,updateAssignment:C,getAssignment:I,getWeekDates:i,importMetadata:t,dailyTargets:T,setDailyTarget:B}=Zs(),[_,Ee]=o.useState("week"),[ae,ye]=o.useState("all"),[os,ze]=o.useState(!1),[xs,es]=o.useState(""),[j,P]=o.useState(c),[be,ss]=o.useState(!1),[ts,Q]=o.useState(""),[Ae]=St(ts,150),[te,ms]=o.useState(null),[F,Ie]=o.useState(1),[ne,Be]=o.useState("V"),[re,hs]=o.useState(c),[le,us]=o.useState(7),[O,ee]=o.useState(!1),[ie,y]=o.useState(!1),[Ne,pe]=o.useState(!1),[ve,ce]=o.useState(!1),[Ke,fs]=o.useState(c),Y=s=>{const n=s.skills.map(l=>l.license).filter(Boolean);return n.includes("B1/2")?"B1-2":n.includes("B1")?"B1":n.includes("B2")?"B2":n.includes("A")?"Cat A":n.includes("C")?"C":"None"},S=o.useMemo(()=>{const s=p(Ke,"yyyy-MM-dd"),n=r.filter(x=>x.date===s&&a.some(E=>String(E.id)===String(x.employeeId))),l=Ns(a,r,s),b=n.filter(x=>G(x.shiftCode)).length,U=a.length-b,H=n.filter(x=>x.shiftCode==="V").length,R=n.filter(x=>["S","IW","IC","AC","AW"].includes(x.shiftCode)).length,Ze=n.filter(x=>a.find(M=>M.id===x.employeeId)?.role==="SrEng"&&G(x.shiftCode)).length,u=n.filter(x=>a.find(M=>M.id===x.employeeId)?.role==="PS"&&G(x.shiftCode)).length,d=n.filter(x=>a.find(M=>M.id===x.employeeId)?.role==="PM"&&G(x.shiftCode)).length,h=n.filter(x=>{const E=a.find(V=>V.id===x.employeeId);if(!E)return!1;const M=Y(E);return(M==="B1"||M==="B1-2")&&G(x.shiftCode)}).length,$=n.filter(x=>{const E=a.find(V=>V.id===x.employeeId);if(!E)return!1;const M=Y(E);return(M==="B2"||M==="B1-2")&&G(x.shiftCode)}).length,Le=n.filter(x=>{const E=a.find(V=>V.id===x.employeeId);return E?Y(E)==="Cat A"&&G(x.shiftCode):!1}).length,Je=n.filter(x=>["Ea","e","Ae"].includes(x.shiftCode)).length,Ce=n.filter(x=>["La","l","LA","AL"].includes(x.shiftCode)).length,de=n.filter(x=>["N","n"].includes(x.shiftCode)).length,N=T[s]??ls,oe=new Date(s),z=Us(oe)%2===0,rs=n.filter(x=>{const E=a.find(bs=>bs.id===x.employeeId);if(!E)return!1;const M=E.role?.toUpperCase()||"";if(M==="PM"||M==="PS"||M==="SE")return!1;const V=x.shiftCode;return z?V==="Ea"||V==="e":V==="La"}).length;return{dateStr:s,currentManhours:l,dayTarget:N,onDutyCount:b,offDutyCount:U,vacationCount:H,sickCount:R,seOnDuty:Ze,psOnDuty:u,pmOnDuty:d,b1OnDuty:h,b2OnDuty:$,catAOnDuty:Le,earlyShifts:Je,lateShifts:Ce,nightShifts:de,dailyTargetCount:rs,isEaWeek:z}},[Ke,r,a,T]);p(j,"yyyy-MM-dd");const nt=[{code:"V",label:"Vacation (V)"},{code:"-",label:"Day Off (-)"},{code:"S",label:"Sick (S)"},{code:"KO",label:"Komp. Overtime (KO)"},{code:"FL",label:"Komp. Flextime (FL)"},{code:"UL",label:"Unpaid Leave (UL)"},{code:"MC",label:"Military (MC)"},{code:"TR",label:"Training (TR)"}],at=s=>{te&&C(s,te,ne)},rt=()=>{!te||!g.results||g.results.forEach(s=>{s.result.canGrant&&C(s.dateStr,te,ne)})},Ps=o.useMemo(()=>{if(!Ae.trim())return[];const s=Ae.toLowerCase().trim();return a.filter(n=>n.name.toLowerCase().includes(s)||n.initials.toLowerCase().includes(s)).slice(0,8)},[a,Ae]),L=o.useMemo(()=>te?a.find(s=>s.id===te):null,[a,te]),ps=o.useMemo(()=>{const s=["THRU","MELM","YCCR","TIMJ","HUAB","YYRJ","MECU","LECN","LCLE","HUDM","ARUZ","KRZE","LSIE","AAUL","WINY","SOER","ERIZ","BHAE","DALL","GBRU","LUPR","RREN","GNET","TOKR","COSM","FILM","PAAO","LUCP","MF","NATS","MZIM","TIML","OLCR","WEZE","JAWE","KRAF","RUAC","SAEF","LABB","RDAR","ARNG","MCOS","THNA","JUTI","GERO","MURB","BOGO","EGGL","RULO","RPAS","DMIA","ENRL","ATET_1","BOEO","DEOM","PKRI"];return[...ae==="all"?a:a.filter(l=>l.department===ae)].sort((l,b)=>{const U=s.indexOf(l.initials),H=s.indexOf(b.initials);return U===-1&&H===-1?0:U===-1?1:H===-1?-1:U-H})},[a,ae]),Ye=o.useMemo(()=>i(c),[c,i]),Ls=o.useMemo(()=>{const s=Gt(c),n=Wt(c);return pt({start:s,end:n})},[c]),se=p(c,"yyyy-MM-dd"),Rs=o.useMemo(()=>Ns(a,r,se),[a,r,se]);o.useMemo(()=>gt(a,r,Ye),[a,r,Ye]);const qe=o.useMemo(()=>{const s=se,n=r.filter(R=>R.date===s&&a.some(Ze=>String(Ze.id)===String(R.employeeId))),l=n.filter(R=>G(R.shiftCode)).length,b=n.filter(R=>["Ea","e","Ae"].includes(R.shiftCode)).length,U=n.filter(R=>["La","l","LA","AL"].includes(R.shiftCode)).length,H=a.length-l;return{onDuty:l,earlyShifts:b,lateShifts:U,offDuty:H}},[r,se,a]),gs=[{code:"TR",label:"Training",color:"bg-purple-500"},{code:"SI",label:"School Internal",color:"bg-blue-500"},{code:"SE",label:"School External",color:"bg-indigo-500"},{code:"Sn",label:"School Night",color:"bg-violet-500"},{code:"ET",label:"Educational Trip",color:"bg-cyan-500"},{code:"T",label:"Training (Off)",color:"bg-purple-400"}],Fs=o.useMemo(()=>{const s=[];for(let n=0;n<le;n++)s.push(p(_e(re,n),"yyyy-MM-dd"));return s},[re,le]),Pe=o.useMemo(()=>{const s=gs.map(b=>b.code);return r.filter(b=>Fs.includes(b.date)&&s.includes(b.shiftCode)).map(b=>{const U=a.find(R=>R.id===b.employeeId),H=gs.find(R=>R.code===b.shiftCode);return U?{...U,educationType:b.shiftCode,educationLabel:H?.label,educationColor:H?.color,educationDate:b.date}:null}).filter(Boolean)},[r,a,Fs]),ns=o.useMemo(()=>{const s=r.filter(l=>l.shiftCode==="FT"),n={};return s.forEach(l=>{n[l.employeeId]||(n[l.employeeId]={dates:[]}),n[l.employeeId].dates.push(l.date)}),a.map(l=>({...l,ftCount:n[l.id]?.dates.length||0,ftDates:(n[l.id]?.dates||[]).sort()})).sort((l,b)=>b.ftCount-l.ftCount)},[r,a]),as=o.useMemo(()=>{const s=r.filter(l=>l.shiftCode==="V"),n={};return s.forEach(l=>{n[l.employeeId]||(n[l.employeeId]={dates:[]}),n[l.employeeId].dates.push(l.date)}),a.map(l=>({...l,vCount:n[l.id]?.dates.length||0,vDates:(n[l.id]?.dates||[]).sort()})).sort((l,b)=>b.vCount-l.vCount)},[r,a]),g=o.useMemo(()=>{const s=[];for(let u=0;u<F;u++)s.push(p(_e(j,u),"yyyy-MM-dd"));const n=u=>{const d=r.filter(m=>m.date===u&&a.some(k=>String(k.id)===String(m.employeeId))),h=Ns(a,r,u),$=d.filter(m=>G(m.shiftCode)).length,Le=a.length-$,Je=d.filter(m=>m.shiftCode==="V").length,Ce=d.filter(m=>["S","IW","IC","AC","AW"].includes(m.shiftCode)).length,de=d.filter(m=>a.find(W=>W.id===m.employeeId)?.role==="SrEng"&&G(m.shiftCode)).length,N=d.filter(m=>a.find(W=>W.id===m.employeeId)?.role==="PS"&&G(m.shiftCode)).length,oe=d.filter(m=>{const k=a.find(xe=>xe.id===m.employeeId);if(!k)return!1;const W=Y(k);return(W==="B1"||W==="B1-2")&&G(m.shiftCode)}),ys=d.filter(m=>{const k=a.find(xe=>xe.id===m.employeeId);if(!k)return!1;const W=Y(k);return(W==="B2"||W==="B1-2")&&G(m.shiftCode)}),z=d.filter(m=>{const k=a.find(xe=>xe.id===m.employeeId);return k?Y(k)==="Cat A"&&G(m.shiftCode):!1}),rs=a.filter(m=>{const k=Y(m);return k==="B1"||k==="B1-2"}).length,x=a.filter(m=>{const k=Y(m);return k==="B2"||k==="B1-2"}).length,E=a.filter(m=>Y(m)==="Cat A").length;let M=0;a.forEach(m=>{m.role!=="PM"&&m.role!=="PS"&&(M+=8*(m.grade/100))});const V=M>0?me/M:1,bs=Math.ceil(rs*V),lt=Math.ceil(x*V),it=Math.ceil(E*V),ct=[0,6].includes(Is(new Date(u))),dt=new Date(u),Gs=Us(dt)%2===0,ot=d.filter(m=>{const k=a.find(xt=>xt.id===m.employeeId);if(!k)return!1;const W=k.role?.toUpperCase()||"";if(W==="PM"||W==="PS"||W==="SE")return!1;const xe=m.shiftCode;return Gs?xe==="Ea"||xe==="e":xe==="La"}).length;return{dateStr:u,currentManhours:h,onDutyCount:$,offDutyCount:Le,vacationCount:Je,sickCount:Ce,seOnDuty:de,psOnDuty:N,b1OnDuty:oe.length,b2OnDuty:ys.length,catAOnDuty:z.length,totalB1:rs,totalB2:x,totalCatA:E,minB1Required:bs,minB2Required:lt,minCatARequired:it,totalPotentialManhours:M,requiredPercentage:V,isWeekend:ct,dailyTargetCount:ot,isEaWeek:Gs}},l=s.map(n),b=(u,d)=>{const h=[];let $=!0;if(d.isWeekend&&h.push({type:"yes",text:"Weekend - reduced staffing requirements"}),u){const Le=u.grade===0;if(u.role==="PS"){const N=d.psOnDuty-1;N>=X?h.push({type:"yes",text:`PS coverage OK: ${N} PS remain after granting (min ${X})`}):(h.push({type:"no",text:`PS coverage insufficient: only ${N} PS after granting (need ${X})`}),$=!1)}if(u.role==="SrEng"){const N=d.seOnDuty-1;N>=J?h.push({type:"yes",text:`SE coverage OK: ${N} SE remain after granting (min ${J})`}):(h.push({type:"no",text:`SE coverage insufficient: only ${N} SE after granting (need ${J})`}),$=!1)}const Je=8*(u.grade/100),Ce=d.currentManhours-Je;if(Le?h.push({type:"yes",text:`${u.initials} has 0% grade - no manhours impact`}):Ce>=me?h.push({type:"yes",text:`Manhours OK: ${Ce.toFixed(1)}h after granting (min ${me}h)`}):(h.push({type:"no",text:`Manhours insufficient: ${Ce.toFixed(1)}h after granting (need ${me}h)`}),$=!1),!Le&&u.role!=="PM"&&u.role!=="PS"){const oe=r.find(z=>z.date===d.dateStr&&z.employeeId===u.id)?.shiftCode||"-";if(d.isEaWeek?oe==="Ea"||oe==="e":oe==="La"){const z=d.dailyTargetCount-1;z<Qe?(h.push({type:"no",text:`Daily Target would drop to ${z} (min ${Qe} required)`}),$=!1):z<we?h.push({type:"info",text:`⚠️ WARNING: Daily Target will drop to ${z} (orange zone, ${we}+ preferred)`}):h.push({type:"yes",text:`Daily Target OK: ${z} after granting (≥${we})`})}else h.push({type:"yes",text:`Employee not on ${d.isEaWeek?"Ea":"La"} shift - no daily target impact`})}const de=Y(u);if(de==="B1"||de==="B1-2"){const N=d.b1OnDuty-1;N>=d.minB1Required?h.push({type:"yes",text:`B1 coverage OK: ${N} on duty after granting (min ${d.minB1Required})`}):(h.push({type:"no",text:`B1 coverage low: ${N} after granting (min ${d.minB1Required})`}),$=!1)}if(de==="B2"||de==="B1-2"){const N=d.b2OnDuty-1;N>=d.minB2Required?h.push({type:"yes",text:`B2 coverage OK: ${N} on duty after granting (min ${d.minB2Required})`}):(h.push({type:"no",text:`B2 coverage low: ${N} after granting (min ${d.minB2Required})`}),$=!1)}if(de==="Cat A"){const N=d.catAOnDuty-1,oe=u.grade<=50?.5:1;N>=d.minCatARequired?h.push({type:"yes",text:`Cat A coverage OK: ${N} on duty after granting (min ${d.minCatARequired})`}):h.push({type:"info",text:`Cat A at ${N} after granting (min ${d.minCatARequired}), grade ${u.grade}% = ${oe*100}% factor`})}}else d.currentManhours>=me?h.push({type:"yes",text:`Current manhours: ${d.currentManhours.toFixed(1)}h (min ${me}h)`}):(h.push({type:"no",text:`Current manhours: ${d.currentManhours.toFixed(1)}h (need ${me}h)`}),$=!1),d.seOnDuty>=J?h.push({type:"yes",text:`SE on duty: ${d.seOnDuty} (min ${J})`}):(h.push({type:"no",text:`SE on duty: ${d.seOnDuty} (need ${J})`}),$=!1),d.psOnDuty>=X?h.push({type:"yes",text:`PS on duty: ${d.psOnDuty} (min ${X})`}):(h.push({type:"no",text:`PS on duty: ${d.psOnDuty} (need ${X})`}),$=!1),h.push({type:"info",text:`B1: ${d.b1OnDuty}/${d.minB1Required} min | B2: ${d.b2OnDuty}/${d.minB2Required} min | Cat A: ${d.catAOnDuty}/${d.minCatARequired} min`}),d.dailyTargetCount<Qe?h.push({type:"no",text:`Daily Target: ${d.dailyTargetCount} (${d.isEaWeek?"Ea":"La"} week) - RED ZONE, no off-days should be granted`}):d.dailyTargetCount<we?h.push({type:"info",text:`⚠️ Daily Target: ${d.dailyTargetCount} (${d.isEaWeek?"Ea":"La"} week) - ORANGE ZONE`}):h.push({type:"yes",text:`Daily Target: ${d.dailyTargetCount} (${d.isEaWeek?"Ea":"La"} week) - GREEN ZONE`});return{canGrant:$,reasons:h,empSpecific:!!u}},U=l.map(u=>({...u,result:b(L??null,u)})),H=U.every(u=>u.result.canGrant),R=Math.max(0,(l[0]?.seOnDuty||0)-J),Ze=Math.max(0,(l[0]?.psOnDuty||0)-X);return{canGrant:H,results:U,message:H?F>1?`OFF DAY CAN BE GRANTED (${F} days)`:"OFF DAY CAN BE GRANTED":"OFF DAY CANNOT BE GRANTED",stats:l[0]||{},positionVacation:{seCanTake:R,psCanTake:Ze,seOnDuty:l[0]?.seOnDuty||0,psOnDuty:l[0]?.psOnDuty||0}}},[j,F,r,a,L]),$s=o.useCallback(s=>{o.startTransition(()=>{f(_e(c,s==="prev"?-1:1))})},[c,f]),Vs=o.useCallback(s=>{o.startTransition(()=>{f(s==="prev"?Ut(c):tt(c,1))})},[c,f]),Ws=o.useCallback(s=>{o.startTransition(()=>{f(s==="prev"?_t(c):st(c,1))})},[c,f]),js=o.useCallback((s,n,l)=>{C(s,n,l)},[C]);return e.jsxs("div",{className:"p-6 lg:p-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl lg:text-3xl font-display font-bold tracking-tight",children:"Schedule"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage daily shift assignments for TMBA teams"})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx(kt,{value:_,onValueChange:s=>Ee(s),children:e.jsxs(Dt,{children:[e.jsx(Ms,{value:"day","data-testid":"tab-day-view",children:"Day"}),e.jsx(Ms,{value:"week","data-testid":"tab-week-view",children:"Week"}),e.jsx(Ms,{value:"month","data-testid":"tab-month-view",children:"Month"})]})}),e.jsxs(w,{variant:"outline",className:"gap-2",onClick:()=>window.print(),"data-testid":"button-print",children:[e.jsx(Tt,{className:"w-4 h-4"}),"Print / PDF"]}),e.jsx(Ht,{}),e.jsxs(Me,{open:ve,onOpenChange:ce,children:[e.jsx(ke,{asChild:!0,children:e.jsxs(w,{variant:"outline",className:"gap-2",children:[e.jsx(Ot,{className:"w-4 h-4"}),"Check Date"]})}),e.jsxs(De,{className:"max-w-2xl",children:[e.jsx(Te,{children:e.jsx(Oe,{children:"Detailed Daily Status"})}),e.jsxs("div",{className:"space-y-6 py-2",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx(vs,{mode:"single",selected:Ke,onSelect:s=>s&&fs(s),weekStartsOn:1,className:"rounded-md border shadow-sm"})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(K,{className:"p-4 text-center bg-blue-50/50 dark:bg-blue-900/10",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase font-bold",children:"Manhours"}),e.jsx("p",{className:"text-2xl font-bold text-blue-700 dark:text-blue-400",children:S.currentManhours.toFixed(1)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Target: ",S.dayTarget]})]}),e.jsxs(K,{className:"p-4 text-center bg-green-50/50 dark:bg-green-900/10",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase font-bold",children:"On Duty"}),e.jsx("p",{className:"text-2xl font-bold text-green-700 dark:text-green-400",children:S.onDutyCount}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Total: ",a.length]})]}),e.jsxs(K,{className:v("p-4 text-center",S.dailyTargetCount>=we?"bg-green-50/50 dark:bg-green-900/10":S.dailyTargetCount>=Qe?"bg-orange-50/50 dark:bg-orange-900/10":"bg-red-50/50 dark:bg-red-900/10"),children:[e.jsxs("p",{className:"text-xs text-muted-foreground uppercase font-bold",children:[S.isEaWeek?"Early":"Late"," Target"]}),e.jsx("p",{className:v("text-2xl font-bold",S.dailyTargetCount>=we?"text-green-700 dark:text-green-400":S.dailyTargetCount>=Qe?"text-orange-700 dark:text-orange-400":"text-red-700 dark:text-red-400"),children:S.dailyTargetCount}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Min Safe: ",we]})]}),e.jsxs(K,{className:"p-4 text-center bg-slate-50/50 dark:bg-slate-900/10",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase font-bold",children:"Sick / Vac"}),e.jsxs("p",{className:"text-2xl font-bold text-slate-700 dark:text-slate-400",children:[S.sickCount," / ",S.vacationCount]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Absences"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium border-b pb-1",children:"Role Coverage"}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{children:"Sr. Engineer"}),e.jsxs(A,{variant:S.seOnDuty>=J?"outline":"destructive",children:[S.seOnDuty," / ",J]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{children:"Prod. Sup. (PS)"}),e.jsxs(A,{variant:S.psOnDuty>=X?"outline":"destructive",children:[S.psOnDuty," / ",X]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{children:"Project Mgr. (PM)"}),e.jsx(A,{variant:"secondary",children:S.pmOnDuty})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium border-b pb-1",children:"License Coverage"}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{children:"B1"}),e.jsx("span",{className:"font-mono font-bold",children:S.b1OnDuty})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{children:"B2"}),e.jsx("span",{className:"font-mono font-bold",children:S.b2OnDuty})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{children:"Cat A"}),e.jsx("span",{className:"font-mono font-bold",children:S.catAOnDuty})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium border-b pb-1",children:"Shift Types"}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{children:"Early"}),e.jsx("span",{className:"font-mono font-bold",children:S.earlyShifts})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{children:"Late"}),e.jsx("span",{className:"font-mono font-bold",children:S.lateShifts})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{children:"Night"}),e.jsx("span",{className:"font-mono font-bold",children:S.nightShifts})]})]})]})]})]})]}),e.jsxs(Me,{children:[e.jsx(ke,{asChild:!0,children:e.jsxs(w,{variant:"outline",className:"gap-2","data-testid":"button-check-off-day",children:[e.jsx(Re,{className:"w-4 h-4"}),"Check Off Day"]})}),e.jsxs(De,{className:"max-w-5xl max-h-[90vh] p-0",children:[e.jsx(Te,{className:"px-6 pt-6 pb-4 border-b",children:e.jsx(Oe,{className:"text-xl",children:"Off Day Availability Check"})}),e.jsxs("div",{className:"flex flex-col lg:flex-row",children:[e.jsxs("div",{className:"lg:w-[340px] border-b lg:border-b-0 lg:border-r p-4 bg-muted/30 space-y-4",children:[e.jsxs("div",{children:[e.jsx(Se,{className:"text-sm font-medium mb-2 block",children:"Search Employee (name or code)"}),e.jsxs("div",{className:"relative",children:[e.jsx(wt,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"}),e.jsx(Cs,{placeholder:"e.g. THRU or Thurner",value:ts,onChange:s=>Q(s.target.value),className:"pl-9","data-testid":"input-employee-search"})]}),Ps.length>0&&e.jsx("div",{className:"mt-2 border rounded-md bg-background max-h-48 overflow-y-auto",children:Ps.map(s=>e.jsxs("button",{onClick:()=>{ms(s.id),Q("")},className:"w-full px-3 py-2 text-left hover:bg-muted flex items-center gap-2 text-sm","data-testid":`employee-option-${s.initials}`,children:[e.jsx(zs,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:s.initials}),e.jsx("span",{className:"text-muted-foreground",children:s.name}),e.jsx(A,{variant:"outline",className:"ml-auto text-xs",children:Y(s)})]},s.id))}),L&&e.jsxs("div",{className:"mt-2 p-3 rounded-lg bg-primary/10 border border-primary/20",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(zs,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:L.initials}),e.jsx("p",{className:"text-xs text-muted-foreground",children:L.name})]})]}),e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>ms(null),className:"h-6 px-2",children:"Clear"})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-1",children:[e.jsx(A,{variant:"secondary",children:Y(L)}),e.jsx(A,{variant:"outline",children:L.role}),e.jsxs(A,{variant:"outline",children:[L.grade,"% grade"]})]})]})]}),e.jsxs("div",{children:[e.jsx(Se,{className:"text-sm font-medium mb-2 block",children:"Days to Check"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(he,{value:F.toString(),onValueChange:s=>Ie(parseInt(s)),children:[e.jsx(ue,{className:"w-24","data-testid":"select-days-to-check",children:e.jsx(ge,{})}),e.jsx(fe,{children:[1,2,3,4,5,6,7,8,9,10].map(s=>e.jsxs(D,{value:s.toString(),children:[s," day",s>1?"s":""]},s))})]}),e.jsx("div",{className:"flex-1",children:e.jsx(Cs,{type:"number",min:"1",max:"365",value:F,onChange:s=>Ie(Math.max(1,Math.min(365,parseInt(s.target.value)||1))),placeholder:"Custom",className:"w-full","data-testid":"input-days-custom"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:F===1?"Single day":`${F} consecutive days`})]}),e.jsxs("div",{children:[e.jsx(Se,{className:"text-sm font-medium mb-2 block",children:"Start Date"}),e.jsx(vs,{mode:"single",selected:j,onSelect:s=>s&&P(s),weekStartsOn:1,className:"rounded-md border mx-auto","data-testid":"calendar-off-day-date"})]}),e.jsxs("div",{className:"text-center p-2 bg-background rounded border",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Checking:"}),e.jsxs("p",{className:"text-sm font-bold",children:[p(j,"MMM d"),F>1&&` - ${p(_e(j,F-1),"MMM d, yyyy")}`,F===1&&`, ${p(j,"yyyy")}`]})]}),L&&e.jsxs("div",{children:[e.jsx(Se,{className:"text-sm font-medium mb-2 block",children:"Off Day Type"}),e.jsxs(he,{value:ne,onValueChange:s=>Be(s),children:[e.jsx(ue,{"data-testid":"select-off-day-type",children:e.jsx(ge,{})}),e.jsx(fe,{children:nt.map(s=>e.jsx(D,{value:s.code,children:s.label},s.code))})]})]})]}),e.jsx(Ue,{className:"flex-1 max-h-[60vh] lg:max-h-[70vh]",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs(K,{className:v("p-4",g.canGrant?"bg-green-50 border-green-200 dark:bg-green-950/30 dark:border-green-800":"bg-red-50 border-red-200 dark:bg-red-950/30 dark:border-red-800"),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[g.canGrant?e.jsx(Re,{className:"w-8 h-8 text-green-600"}):e.jsx(Xe,{className:"w-8 h-8 text-red-600"}),e.jsxs("div",{children:[e.jsx("span",{className:v("font-bold text-lg block",g.canGrant?"text-green-700 dark:text-green-400":"text-red-700 dark:text-red-400"),children:g.message}),L&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:["for ",L.initials," (",L.name,")"]})]})]}),g.positionVacation&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Position Availability:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[(()=>{const s=L?.role==="SrEng",n=s?g.positionVacation.seOnDuty-1:g.positionVacation.seOnDuty,l=s?n>=J:g.positionVacation.seCanTake>0;return e.jsxs("div",{className:v("rounded-lg p-3 border",l?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold",children:"SE"}),l?e.jsx(Re,{className:"w-5 h-5 text-green-600"}):e.jsx(Xe,{className:"w-5 h-5 text-red-600"})]}),e.jsx("div",{className:"text-2xl font-bold mt-1",children:g.positionVacation.seCanTake}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"can take off"}),e.jsxs("div",{className:"text-xs mt-1",children:["(",g.positionVacation.seOnDuty," on duty, min ",J,")"]})]})})(),(()=>{const s=L?.role==="PS",n=s?g.positionVacation.psOnDuty-1:g.positionVacation.psOnDuty,l=s?n>=X:g.positionVacation.psCanTake>0;return e.jsxs("div",{className:v("rounded-lg p-3 border",l?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold",children:"PS"}),l?e.jsx(Re,{className:"w-5 h-5 text-green-600"}):e.jsx(Xe,{className:"w-5 h-5 text-red-600"})]}),e.jsx("div",{className:"text-2xl font-bold mt-1",children:g.positionVacation.psCanTake}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"can take off"}),e.jsxs("div",{className:"text-xs mt-1",children:["(",g.positionVacation.psOnDuty," on duty, min ",X,")"]})]})})()]})]}),g.stats&&e.jsxs("div",{className:"grid grid-cols-5 gap-2 mb-4 text-sm",children:[e.jsxs("div",{className:"bg-white/70 dark:bg-black/20 rounded p-2 text-center",children:[e.jsx("div",{className:"font-bold text-lg",children:g.stats.currentManhours?.toFixed(0)||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Manhours"})]}),e.jsxs("div",{className:"bg-white/70 dark:bg-black/20 rounded p-2 text-center",children:[e.jsx("div",{className:"font-bold text-lg",children:g.stats.b1OnDuty||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"B1"})]}),e.jsxs("div",{className:"bg-white/70 dark:bg-black/20 rounded p-2 text-center",children:[e.jsx("div",{className:"font-bold text-lg",children:g.stats.b2OnDuty||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"B2"})]}),e.jsxs("div",{className:"bg-white/70 dark:bg-black/20 rounded p-2 text-center",children:[e.jsx("div",{className:"font-bold text-lg",children:g.stats.catAOnDuty||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Cat A"})]}),e.jsxs("div",{className:"bg-white/70 dark:bg-black/20 rounded p-2 text-center",children:[e.jsx("div",{className:"font-bold text-lg",children:g.stats.sickCount||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Sick"})]})]})]}),g.results?.map((s,n)=>e.jsxs(K,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.result.canGrant?e.jsx(Re,{className:"w-5 h-5 text-green-600"}):e.jsx(Xe,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"font-semibold",children:p(new Date(s.dateStr),"EEE, MMM d")}),e.jsx(A,{variant:s.result.canGrant?"default":"destructive",children:s.result.canGrant?"OK":"NO"}),L&&s.result.canGrant&&e.jsxs(w,{size:"sm",className:"ml-auto",onClick:()=>at(s.dateStr),"data-testid":`apply-off-day-${n}`,children:["Apply ",ne]})]}),e.jsx("div",{className:"space-y-1",children:s.result.reasons.map((l,b)=>e.jsxs("div",{className:v("flex items-start gap-2 text-sm p-2 rounded",l.type==="yes"?"bg-green-100/50 dark:bg-green-900/20":l.type==="no"?"bg-red-100/50 dark:bg-red-900/20":"bg-blue-100/50 dark:bg-blue-900/20"),children:[l.type==="yes"?e.jsx(Re,{className:"w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"}):l.type==="no"?e.jsx(Xe,{className:"w-4 h-4 text-red-600 flex-shrink-0 mt-0.5"}):e.jsx(Es,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:l.type==="yes"?"text-green-700 dark:text-green-400":l.type==="no"?"text-red-700 dark:text-red-400":"text-blue-700 dark:text-blue-400",children:l.text})]},b))})]},n)),L&&g.canGrant&&g.results&&g.results.length>1&&e.jsxs(w,{className:"w-full",onClick:rt,"data-testid":"apply-all-off-days",children:["Apply ",ne," to All ",g.results.filter(s=>s.result.canGrant).length," Approved Days"]}),e.jsxs("div",{className:"text-xs text-muted-foreground bg-muted/50 p-3 rounded",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Off Day Rules:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-0.5",children:[e.jsxs("li",{children:["Minimum ",me," manhours must remain"]}),e.jsxs("li",{children:["Minimum ",J," SE must remain on duty"]}),e.jsxs("li",{children:["Minimum ",X," PS must remain on duty"]}),e.jsxs("li",{children:["B1/B2/Cat A coverage based on % of ",me,"h vs total potential"]}),e.jsx("li",{children:"Grade 0% employees can always take off"}),e.jsx("li",{children:"B1-2 license counts toward both B1 and B2"})]})]})]})})]})]})]}),e.jsxs(Me,{children:[e.jsx(ke,{asChild:!0,children:e.jsxs(w,{variant:"outline",size:"sm",className:"gap-2","data-testid":"button-training-view",children:[e.jsx(As,{className:"w-4 h-4"}),"Education",Pe.length>0&&e.jsx(A,{variant:"secondary",className:"ml-1 h-5 px-1.5 text-xs",children:Pe.length})]})}),e.jsxs(De,{className:"max-w-2xl max-h-[85vh] p-0",children:[e.jsx(Te,{className:"px-6 pt-6 pb-4 border-b",children:e.jsxs(Oe,{className:"flex items-center gap-2",children:[e.jsx(As,{className:"w-5 h-5"}),"Training & Education Overview"]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-end gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Se,{className:"text-xs",children:"Start Date"}),e.jsxs(Xs,{open:O,onOpenChange:ee,children:[e.jsx(Qs,{asChild:!0,children:e.jsxs(w,{variant:"outline",size:"sm",className:"w-[160px] justify-start text-left font-normal",children:[e.jsx(Fe,{className:"mr-2 h-4 w-4"}),p(re,"MMM d, yyyy")]})}),e.jsx(et,{className:"w-auto p-0",align:"start",children:e.jsx(vs,{mode:"single",selected:re,onSelect:s=>{s&&(hs(s),ee(!1))},weekStartsOn:1,initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Se,{className:"text-xs",children:"Period"}),e.jsxs(he,{value:String(le),onValueChange:s=>us(Number(s)),children:[e.jsx(ue,{className:"w-[120px]",children:e.jsx(ge,{})}),e.jsxs(fe,{children:[e.jsx(D,{value:"1",children:"1 day"}),e.jsx(D,{value:"7",children:"7 days"}),e.jsx(D,{value:"14",children:"14 days"}),e.jsx(D,{value:"30",children:"30 days"})]})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[p(re,"MMM d")," - ",p(_e(re,le-1),"MMM d, yyyy")]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:gs.map(s=>e.jsxs("div",{className:"flex items-center gap-1.5 text-xs px-2 py-1 bg-muted rounded",children:[e.jsx("span",{className:v("w-2.5 h-2.5 rounded-full",s.color)}),e.jsx("span",{className:"font-medium",children:s.code}),e.jsxs("span",{className:"text-muted-foreground",children:["- ",s.label]})]},s.code))}),Pe.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No employees in training/school during this period"}):e.jsx(Ue,{className:"h-[350px] border rounded-lg",children:e.jsxs(ks,{children:[e.jsx(Ds,{children:e.jsxs(We,{children:[e.jsx(q,{children:"Employee"}),e.jsx(q,{children:"Department"}),e.jsx(q,{children:"Date"}),e.jsx(q,{children:"Type"})]})}),e.jsx(Ts,{children:Pe.map((s,n)=>e.jsxs(We,{children:[e.jsx(Z,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-primary/10 flex items-center justify-center text-xs font-bold",children:s.initials}),e.jsx("span",{className:"font-medium",children:s.name})]})}),e.jsx(Z,{className:"text-muted-foreground",children:s.department.replace("S/","")}),e.jsx(Z,{children:p(new Date(s.educationDate),"EEE, MMM d")}),e.jsx(Z,{children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:v("w-2 h-2 rounded-full",s.educationColor)}),e.jsx(A,{variant:"outline",className:"text-xs",children:s.educationType})]})})]},`${s.id}-${s.educationDate}-${n}`))})]})}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-muted-foreground pt-2 border-t",children:[e.jsxs("span",{children:["Total: ",Pe.length," education entries"]}),e.jsxs("span",{children:[new Set(Pe.map(s=>s.id)).size," unique employees"]})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Me,{open:Ne,onOpenChange:pe,children:[e.jsx(ke,{asChild:!0,children:e.jsxs(w,{variant:"outline",size:"sm",className:"gap-2","data-testid":"button-vacation-summary",children:[e.jsx(Fe,{className:"w-4 h-4 text-orange-500"}),"Vacation Summary",e.jsx(A,{variant:"secondary",className:"ml-1 h-5 px-1.5 text-xs",children:as.reduce((s,n)=>s+n.vCount,0)})]})}),e.jsxs(De,{className:"max-w-3xl max-h-[85vh] p-0",children:[e.jsx(Te,{className:"px-6 pt-6 pb-4 border-b",children:e.jsxs(Oe,{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-5 h-5 text-orange-500"}),"Vacation Summary"]})}),e.jsxs("div",{className:"p-6",children:[e.jsx(Ue,{className:"h-[500px] border rounded-lg",children:e.jsxs(ks,{children:[e.jsx(Ds,{children:e.jsxs(We,{children:[e.jsx(q,{children:"Employee"}),e.jsx(q,{children:"Department"}),e.jsx(q,{className:"text-center",children:"Vacation Days"}),e.jsx(q,{children:"Dates"})]})}),e.jsx(Ts,{children:as.map(s=>e.jsxs(We,{children:[e.jsx(Z,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-orange-100 text-orange-700 flex items-center justify-center text-xs font-bold",children:s.initials}),e.jsx("span",{className:"font-medium",children:s.name})]})}),e.jsx(Z,{className:"text-muted-foreground",children:s.department.replace("S/","")}),e.jsx(Z,{className:"text-center",children:e.jsx(A,{variant:s.vCount>0?"default":"secondary",className:"min-w-[32px]",children:s.vCount})}),e.jsx(Z,{children:s.vCount>0?e.jsx("div",{className:"flex flex-wrap gap-1 max-w-md",children:s.vDates.map(n=>e.jsx(A,{variant:"outline",className:"text-xs bg-orange-50 text-orange-700 border-orange-200",children:p(new Date(n),"MMM d")},n))}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"-"})})]},s.id))})]})}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-muted-foreground pt-4 border-t mt-4",children:[e.jsxs("span",{children:["Total Vacation days: ",as.reduce((s,n)=>s+n.vCount,0)]}),e.jsxs("span",{children:[as.filter(s=>s.vCount>0).length," employees with Vacation"]})]})]})]})]}),e.jsxs(Me,{open:ie,onOpenChange:y,children:[e.jsx(ke,{asChild:!0,children:e.jsxs(w,{variant:"outline",size:"sm",className:"gap-2","data-testid":"button-ft-summary",children:[e.jsx(Fe,{className:"w-4 h-4 text-amber-600"}),"FT Summary",e.jsx(A,{variant:"secondary",className:"ml-1 h-5 px-1.5 text-xs",children:ns.reduce((s,n)=>s+n.ftCount,0)})]})}),e.jsxs(De,{className:"max-w-3xl max-h-[85vh] p-0",children:[e.jsx(Te,{className:"px-6 pt-6 pb-4 border-b",children:e.jsxs(Oe,{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-5 h-5 text-amber-600"}),"FT (Feiertag/Holiday) Summary"]})}),e.jsxs("div",{className:"p-6",children:[e.jsx(Ue,{className:"h-[500px] border rounded-lg",children:e.jsxs(ks,{children:[e.jsx(Ds,{children:e.jsxs(We,{children:[e.jsx(q,{children:"Employee"}),e.jsx(q,{children:"Department"}),e.jsx(q,{className:"text-center",children:"FT Count"}),e.jsx(q,{children:"Dates"})]})}),e.jsx(Ts,{children:ns.map(s=>e.jsxs(We,{children:[e.jsx(Z,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-amber-100 text-amber-700 flex items-center justify-center text-xs font-bold",children:s.initials}),e.jsx("span",{className:"font-medium",children:s.name})]})}),e.jsx(Z,{className:"text-muted-foreground",children:s.department.replace("S/","")}),e.jsx(Z,{className:"text-center",children:e.jsx(A,{variant:s.ftCount>0?"default":"secondary",className:"min-w-[32px]",children:s.ftCount})}),e.jsx(Z,{children:s.ftCount>0?e.jsx("div",{className:"flex flex-wrap gap-1 max-w-md",children:s.ftDates.map(n=>e.jsx(A,{variant:"outline",className:"text-xs bg-amber-50 text-amber-700 border-amber-200",children:p(new Date(n),"MMM d")},n))}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"-"})})]},s.id))})]})}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-muted-foreground pt-4 border-t mt-4",children:[e.jsxs("span",{children:["Total FT days: ",ns.reduce((s,n)=>s+n.ftCount,0)]}),e.jsxs("span",{children:[ns.filter(s=>s.ftCount>0).length," employees with FT"]})]})]})]})]})]}),e.jsxs(he,{value:ae,onValueChange:ye,children:[e.jsx(ue,{className:"w-[140px]","data-testid":"select-department-filter",children:e.jsx(ge,{placeholder:"Department"})}),e.jsxs(fe,{children:[e.jsx(D,{value:"all",children:"All Teams"}),e.jsx(D,{value:"S/TMBA",children:"TMBA"}),e.jsx(D,{value:"S/TMBAA",children:"TMBAA"}),e.jsx(D,{value:"S/TMBAB",children:"TMBAB"}),e.jsx(D,{value:"S/TMBAC",children:"TMBAC"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(K,{className:"p-4 bg-card border-border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(Js,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Daily Hours"}),e.jsx("p",{className:v("text-xl font-display font-bold",Rs<ls?"text-red-500":"text-green-500"),children:Rs.toFixed(1)})]})]})}),e.jsxs(Me,{open:os,onOpenChange:ze,children:[e.jsx(ke,{asChild:!0,children:e.jsxs(K,{className:"p-4 bg-card border-border cursor-pointer hover:bg-muted/50 transition-colors relative group",children:[e.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Et,{className:"w-3 h-3 text-muted-foreground"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-success/10 flex items-center justify-center",children:e.jsx(jt,{className:"w-5 h-5 text-success"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Daily Target"}),e.jsxs("p",{className:"text-xl font-display font-bold",children:[T[se]||ls,"h"]}),T[se]&&e.jsx("p",{className:"text-xs text-muted-foreground font-medium text-primary",children:"Custom Set"})]})]})]})}),e.jsxs(De,{className:"sm:max-w-[425px]",children:[e.jsxs(Te,{children:[e.jsx(Oe,{children:"Set Daily Target"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Set manhours target for ",p(c,"MMMM d, yyyy")]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(Se,{htmlFor:"target",children:"Target Hours"}),e.jsx(Cs,{id:"target",type:"number",placeholder:"216",defaultValue:T[se]||ls,onChange:s=>es(s.target.value)})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Standard default is 216 hours."})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(w,{variant:"outline",onClick:()=>{B(se,216),ze(!1)},children:"Reset to Default"}),e.jsx(w,{onClick:()=>{const s=parseFloat(xs);isNaN(s)||B(se,s),ze(!1)},children:"Save Changes"})]})]})]}),e.jsx(K,{className:"p-4 bg-card border-border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-warning/10 flex items-center justify-center",children:e.jsx(yt,{className:"w-5 h-5 text-warning"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"On Duty"}),e.jsx("p",{className:"text-xl font-display font-bold",children:qe.onDuty})]})]})}),e.jsx(K,{className:"p-4 bg-card border-border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-accent flex items-center justify-center",children:e.jsx(Fe,{className:"w-5 h-5 text-accent-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Off Duty"}),e.jsx("p",{className:"text-xl font-display font-bold",children:qe.offDuty})]})]})})]}),t&&e.jsxs("div",{className:"flex items-center gap-4 px-3 py-2 bg-muted/50 rounded-lg text-xs text-muted-foreground border","data-testid":"import-metadata-info",children:[e.jsx("span",{className:"font-medium text-foreground",children:"Data Source:"}),e.jsxs("span",{children:["Imported ",p(new Date(t.importedAt),"MMM d, yyyy HH:mm")]}),e.jsx("span",{className:"text-border",children:"|"}),e.jsxs("span",{children:[t.employeeCount," employees"]}),e.jsx("span",{className:"text-border",children:"|"}),e.jsxs("span",{children:[t.assignmentCount.toLocaleString()," assignments"]}),t.dateRange&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-border",children:"|"}),e.jsxs("span",{children:["Range: ",p(new Date(t.dateRange.start),"MMM d")," - ",p(new Date(t.dateRange.end),"MMM d, yyyy")]})]})]}),_==="day"&&e.jsxs(K,{className:"overflow-hidden border-border",children:[e.jsxs("div",{className:"p-4 border-b border-border flex items-center justify-between bg-muted/30",children:[e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>$s("prev"),"data-testid":"button-prev-day",children:e.jsx(Ss,{className:"w-5 h-5"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"font-display font-semibold text-lg",children:p(c,"EEEE, MMMM d, yyyy")}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mt-1 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Early: ",qe.earlyShifts]}),e.jsxs("span",{children:["Late: ",qe.lateShifts]}),e.jsxs("span",{children:["Off: ",qe.offDuty]})]})]}),e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>$s("next"),"data-testid":"button-next-day",children:e.jsx(ws,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:ps.map(s=>{const n=I(se,s.id)||"-";return is.find(l=>l.code===n),e.jsxs("div",{className:v("p-3 rounded-lg border flex items-center justify-between",s.role==="PM"&&"bg-amber-50 border-amber-200",s.role==="PS"&&"bg-emerald-50 border-emerald-200",s.role==="SrEng"&&"bg-lime-50 border-lime-200",!["PM","PS","SrEng"].includes(s.role)&&"bg-card border-border"),"data-testid":`employee-card-${s.id}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-xs font-mono font-bold text-primary",children:s.initials}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.role," • ",s.department.replace("S/","")]})]})]}),e.jsx(Bs,{value:n,onValueChange:l=>js(se,s.id,l),"data-testid":`select-shift-day-${s.id}`})]},s.id)})})})]}),_==="week"&&e.jsxs(K,{className:"overflow-hidden border-border",children:[e.jsxs("div",{className:"p-4 border-b border-border flex items-center justify-between bg-muted/30",children:[e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>Vs("prev"),"data-testid":"button-prev-week",children:e.jsx(Ss,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(he,{value:String(Nt(c,{weekStartsOn:1,firstWeekContainsDate:4})),onValueChange:s=>{o.startTransition(()=>{const n=Mt(c,parseInt(s),{weekStartsOn:1,firstWeekContainsDate:4});f(bt(n,{weekStartsOn:1}))})},children:[e.jsx(ue,{className:"w-[100px]","data-testid":"select-week",children:e.jsx(ge,{placeholder:"Week"})}),e.jsx(fe,{children:e.jsx(Ue,{className:"h-[300px]",children:Array.from({length:52},(s,n)=>n+1).map(s=>e.jsxs(D,{value:String(s),children:["Week ",s]},s))})})]}),e.jsxs(he,{value:String(c.getFullYear()),onValueChange:s=>{o.startTransition(()=>{f(new Date(parseInt(s),c.getMonth(),c.getDate()))})},children:[e.jsx(ue,{className:"w-[90px]","data-testid":"select-week-year",children:e.jsx(ge,{})}),e.jsx(fe,{children:[2024,2025,2026,2027,2028].map(s=>e.jsx(D,{value:String(s),children:s},s))})]}),e.jsxs("span",{className:"text-sm text-muted-foreground hidden sm:inline",children:[p(new Date(Ye[0]),"MMM d")," - ",p(new Date(Ye[6]),"MMM d")]})]}),e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>Vs("next"),"data-testid":"button-next-week",children:e.jsx(ws,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(Xt,{employees:ps,weekDates:Ye,getAssignment:I,onShiftChange:js,onDayClick:s=>{o.startTransition(()=>{f(new Date(s))})}})})]}),_==="month"&&e.jsxs(K,{className:"overflow-hidden border-border",children:[e.jsxs("div",{className:"p-4 border-b border-border flex items-center justify-between bg-muted/30",children:[e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>Ws("prev"),"data-testid":"button-prev-month",children:e.jsx(Ss,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(he,{value:String(c.getMonth()),onValueChange:s=>{o.startTransition(()=>{f(new Date(c.getFullYear(),parseInt(s),1))})},children:[e.jsx(ue,{className:"w-[130px]","data-testid":"select-month",children:e.jsx(ge,{})}),e.jsx(fe,{children:["January","February","March","April","May","June","July","August","September","October","November","December"].map((s,n)=>e.jsx(D,{value:String(n),children:s},n))})]}),e.jsxs(he,{value:String(c.getFullYear()),onValueChange:s=>{o.startTransition(()=>{f(new Date(parseInt(s),c.getMonth(),1))})},children:[e.jsx(ue,{className:"w-[90px]","data-testid":"select-year",children:e.jsx(ge,{})}),e.jsx(fe,{children:[2024,2025,2026,2027,2028].map(s=>e.jsx(D,{value:String(s),children:s},s))})]})]}),e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>Ws("next"),"data-testid":"button-next-month",children:e.jsx(ws,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"overflow-x-auto",children:Ls.length>0&&e.jsx(Qt,{employees:ps,monthDays:Ls,getAssignment:I,onShiftChange:js})})]})]})}export{xn as CalendarPage};
